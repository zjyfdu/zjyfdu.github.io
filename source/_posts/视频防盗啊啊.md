---
title: è§†é¢‘é˜²ç›—å•Šå•Š
date: 2018-02-12 11:59:48
categories: flaskç½‘ç«™æ€»ç»“
---

### å‰è¨€
å¥½çƒ¦å•Šï¼Œä¸€ç›´æä¸å®š
ä¸‹é¢åªæ˜¯è®°å½•æˆ‘è¸©è¿‡çš„ä¸€äº›å‘ï¼Œå¤§å®¶ä¸è¦çœ‹äº†

### èƒŒæ™¯
é»˜è®¤çš„videoæ ‡ç­¾ä¼šæœ‰ä¸‹è½½æŒ‰é’®ï¼Œè€Œä¸”ä¸èƒ½å€é€Ÿæ’­æ”¾ï¼Œäºæ˜¯ä½¿ç”¨äº†video.js
ä¸ºé˜²æ­¢ä¸‹è½½videoç¦æ­¢æ‰äº†å³é”®èœå•
ç›®å‰å­˜åœ¨çš„é—®é¢˜
- æ‰“å¼€è°ƒè¯•æˆ–è€…æŸ¥çœ‹åŸç½‘é¡µå¯ä»¥ç›´æ¥çœ‹åˆ°è§†é¢‘é“¾æ¥
- æ‰‹æœºç«¯ä¼šä¹‹é—´æ˜¾ç¤ºæµè§ˆå™¨çš„æ’­æ”¾ç•Œé¢ï¼Œéƒ½æœ‰ç›´æ¥ä¸‹è½½çš„æŒ‰é’®

### é€”å¾„

#### å‘1 ä¿®æ”¹referrer
æƒ³é€šè¿‡referreråˆ¤æ–­æ˜¯å¦æ˜¯æ’­æ”¾è¿˜æ˜¯ç›´æ¥ä¸‹è½½ï¼ˆå…ˆå‡è®¾ä¸‹è½½éƒ½æ˜¯ç©ºreferrerï¼‰
video.jsä¸èƒ½ç›´æ¥æ§åˆ¶httpè¯·æ±‚ï¼Œä¸èƒ½æ§åˆ¶referrer
æ§åˆ¶å…¨å±€referrerå¯ä»¥åœ¨headä¸­åŠ ä¸‹é¢è¿™å¥
```
<meta name="referrer" content="always/never/origin/default">
```
åº”è¯¥æ˜¯ä¸‹è½½ç©ºreferrerè¿™ä¸ªå‡è®¾æœ¬æ¥å°±æœ‰é—®é¢˜ï¼Œè¿™æ¡è·¯å µæ­»äº†

#### å‘2 blob
blobç”¨äºå¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œyoutubeå’Œbilibiliéƒ½æ˜¯ç”¨çš„blobï¼Œçœ‹èµ·æ¥å¾ˆpromising
ä½†æ˜¯æˆ‘ä¸ä¼šç”¨å•Šã€‚ã€‚ã€‚
```
<video id="id" width="320" height="240"  type='video/mp4' controls  > </video>

window.onload = function() {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'mov_bbb.mp4', true);
    xhr.responseType = 'blob'; //important
    xhr.onload = function(e) {
        if (this.status == 200) {
            console.log("loaded");
            var blob = this.response;
            var video = document.getElementById('id');
            video.oncanplaythrough = function() {
                console.log("Can play through video without stopping");
                URL.revokeObjectURL(this.src);
            };
            video.src = URL.createObjectURL(blob);
            video.load();
        }
    };
    xhr.send();
}
```
å¯ä»¥å·¥ä½œï¼Œä½†éœ€è¦å…ˆæŠŠè§†é¢‘åŠ è½½ä¸€éæ‰èƒ½çœ‹ï¼Œæ„æ€æ˜¯è¿™ä¸ªé¡µé¢åŠ è½½æ—¶é—´è¦ä»¥åˆ†é’Ÿæ¥è®°äº†ã€‚ã€‚ã€‚
è€Œä¸”è¿˜æœ‰è·¨åŸŸçš„é—®é¢˜

#### å‘3 é˜¿é‡Œäº‘çš„flash
è¿™ä¸ªå‘è¿˜æ²¡è¸©è¿›å»ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸æƒ³ç”¨flashï¼Œéƒ½2018å¹´äº†å•Š

#### åé¢çš„å‘ 
- ä¸è¡Œå°±ç”¨uaï¼ŒæŠŠæ‰‹æœºç«¯çš„ç¦æ‰ï¼Œç„¶åpcç«¯ç”±ä»–ä»¬ä¸‹å»å§
- ç„¶åå†çœ‹çœ‹[è¿™ä¸ªé“¾æ¥](https://stackoverflow.com/questions/9756837/prevent-html5-video-from-being-downloaded-right-click-saved)é‡Œçš„æ–¹æ³•ï¼Œè¯´ä¸å®šèƒ½ç”¨å‘¢ğŸ˜¢
- è¿‘æœŸä¸æäº†ï¼Œå…ˆä¸“å¿ƒå†™æ¯•ä¸šè®ºæ–‡å§


