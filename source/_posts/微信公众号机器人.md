---
title: 微信公众号机器人
typora-root-url: ../../source
tags:
  - 微信
  - 公众号
categories: flask
date: 2018-10-06 16:47:23
---

# itchatmp
- itchat是个微信机器人，作者通过微信网页版抓的接口
- itchatmp是对应的微信公众号的机器人，微信官方提供的接口，但相比于itchat，不太完善，文档也不行
- 我已经要放弃这个了，这里只记录一下我修改nginx配置的过程
1. `itchatmp.run(port=8180)`，这里首先要指定端口
2. 微信公众号的配置页面里，写上对应的域名，yongxinxue.xin/weixin，由于我根域名被占了，所以建立了个新路径
3. nginx里增加配置，[这里简单说一下last和break的区别](https://blog.csdn.net/zhanlanmg/article/details/49684803)，
```nginx
server {
    listen       80;
    server_name  _;

    location / {
      ...
    }
    location /weixin {
      rewrite /weixin/(.*) /$1 break;
      proxy_pass http://127.0.0.1:8180/;
    }
}
```

> rewrite break 重写后，直接使用当前资源，不再执行location里余下的语句，完成本次请求，地址栏url不变 
> rewrite last 重写后，马上发起一个新的请求，再次进入server块，重试location匹配，超过10次匹配不到报500错误，地址栏url不变

# werobot
- 看着更成熟一点，后面再看，[这里](https://werobot.readthedocs.io/zh_CN/latest/replies.html)
